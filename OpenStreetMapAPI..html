<script>
/*
Version #4


 Kevin Allen (ironmig)'s Prototype for Google code-in 2014 task by FOSSASIA with task to "develop a method to find the Country/City/ZIP code of a Given Longitude,Latitude pair". Implementation in javascript with no required librarys, should work on all modern browsers that can parse json and send ajax requests. Unit testing completed with several random cities in each continent.
 
The program uses OpenStreetMap's Nominatim protocol, which can be self hosted or used through many free hosters, such as mapquest (which is used be default). 

When calling the function, the first two parameters should be latitude and longitude respectivly. They should be Numbers, with positive numbers representing north/east coordinates and negative representing south/west. 

Additionaly, a third parameter should be passed which is a callback function to be used to handle the response data. The response data will be passed as an object into the callback function upon the api request being completed and parsed. 

An optional fourth parameter can be inlcuded, an array of strings such as ['city','country'] which should be searched for and returned. 

An optional fifth parameter can be passed, a string that is the address of the nominatim server to use, should not end in a /. 
 
An example implementation of the program is included bellow the function. Open this file in a web browser to test it out!
*/
function openGeo (lat,lon,callback,find,server) {
    var req = new XMLHttpRequest;
    var server = server || 'http://open.mapquestapi.com/nominatim/v1/reverse.php'; //A valid nominatim reverse geocoding server
    var find = find || ['city','country','postcode','state'];
    var res = {};
    req.open('GET',server+'/reverse?format=json&lat='+lat+'&lon='+lon,true);
    req.send();
    req.onreadystatechange = function () {
        if (req.readyState===4 && req.status===200) {
            data = JSON.parse(req.responseText).address;
            for (var i=0;i<find.length;i++) res[find[i]]=data[find[i]];
            if (callback) callback(res);
        }
    };
}

function testGeo() {
    openGeo (document.getElementById("lat").value,document.getElementById("long").value, function (object) {
            document.getElementById('city').innerHTML = object.city || object.village || object.town; //example of how to handle 
            document.getElementById('zip').innerHTML = object.postcode;
            document.getElementById('country').innerHTML = object.country;
            document.getElementById('state').innerHTML = object.state;
    },['city','country','postcode','state','village','town']);
}
</script>





<style>
table,td,tr {
    border: 1px solid black;
    border-collapse: collapse;
    font-size: 100%;
    background-color: salmon;
}
body {
    font-size: 300%;
    background: #a1eba7;
}
p {
    font-size: 50%;
}
input {
    font-size: 80%;
}
</style>
<center>
    <table>
    <tr>
        <td>City:</td>
        <td id='city'> </td>
    </tr>
    <tr>
        <td>Zip Code</td>
        <td id='zip'></td>
    </tr>
    <tr>
        <td>Country</td>
        <td id='country'></td>
    </tr>
    <tr>
        <td>State</td>
        <td id='state'></td>
    </tr>
    </table>
<form action='#'>
Latitude:<input id='lat' value="-12.0433"><br>
Longitude:<input id='long' value='-77.0283'><br>
<button onclick='testGeo()'>Test</button>
</form>
<p>note: south latitude and west Longitude should be written as negative</p>
</center>